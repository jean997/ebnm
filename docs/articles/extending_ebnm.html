<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Extending ebnm with custom ebnm-style functions • ebnm</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Extending ebnm with custom ebnm-style functions">
<meta property="og:description" content="ebnm">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ebnm</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.1-28</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">Home</a>
</li>
<li>
  <a href="../articles/index.html">Vignettes</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/stephenslab/ebnm" class="external-link">Source</a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Extending ebnm with custom ebnm-style
functions</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/stephenslab/ebnm/blob/HEAD/vignettes/extending_ebnm.Rmd" class="external-link"><code>vignettes/extending_ebnm.Rmd</code></a></small>
      <div class="hidden name"><code>extending_ebnm.Rmd</code></div>

    </div>

    
    
<p>The <strong>ebnm</strong> package, in addition to providing
implementations of several commonly used priors (normal, Laplace, etc.),
was designed to be easily extensible so that researchers are not limited
by the existing options (despite the fact that a wide variety of options
are available!).</p>
<p>In this vignette, we illustrate how to extend <strong>ebnm</strong>
by creating a <em>custom EBNM solver</em> in the style of other
<strong>ebnm</strong> functions such as <code><a href="../reference/ebnm_normal.html">ebnm_normal()</a></code> and
<code><a href="../reference/ebnm_point_laplace.html">ebnm_point_laplace()</a></code>. In this illustration, we implement an
EBNM solver for the family of scaled (Student’s) <em>t</em> priors. (As
of this writing, it is not one of the prior families included in
<strong>ebnm</strong>.) It is formally defined next.</p>
<div class="section level3">
<h3 id="ebnm-for-the-scaled-t-prior-family">EBNM for the scaled-<em>t</em> prior family<a class="anchor" aria-label="anchor" href="#ebnm-for-the-scaled-t-prior-family"></a>
</h3>
<p>The <em>empirical Bayes normal means</em> (EBNM) model with scaled
<em>t</em> prior is:</p>
<span class="math display">\[\begin{aligned}
x_i &amp;\sim \mathcal{N}(\theta_i, s_i^2), \\
\theta_i &amp;\sim g \in \mathcal{G}_t,
\end{aligned}\]</span>
<p><span class="math inline">\(\mathcal{G}_t\)</span> is the family of
scaled <span class="math inline">\(t\)</span> priors and is defined as
follows:</p>
<p><span class="math display">\[\begin{equation}
\mathcal{G}_t := \{g: g = \sigma t_\nu; \sigma &gt; 0, \nu &gt; 0\},
\end{equation}\]</span></p>
<p>in which <span class="math inline">\(t_{\nu}\)</span> is the
<em>t</em> distribution with <span class="math inline">\(\nu\)</span>
degrees of freedom. Fitting the prior therefore involves estimating two
parameters: the scale parameter, <span class="math inline">\(\sigma\)</span>, and the degrees of freedom, <span class="math inline">\(\nu\)</span>.</p>
<p>For background and notation, please see the <a href="https://arxiv.org/abs/2110.00152" class="external-link">ebnm paper</a>.</p>
</div>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In general, to fit an EBNM model one needs to: 1. Specify the prior
family <span class="math inline">\(\mathcal{G}\)</span>; 2. Given
observations <span class="math inline">\(x_i\)</span> with standard
errors <span class="math inline">\(s_i\)</span>, estimate <span class="math inline">\(g \in \mathcal{G}\)</span>; 3. Given an estimate
<span class="math inline">\(\hat{g} \in \mathcal{G}\)</span>, compute
posterior means <span class="math inline">\(\mathbb{E}(\theta_i \mid
x_i, s_i, \hat{g})\)</span> and/or other quantities of interest. In the
following sections, we show how we might implement these three steps for
the prior family <span class="math inline">\(\mathcal{G}_t\)</span>. We
then incorporate these implementations into a new function
<code>ebnm_t()</code> that uses the common interface supplied by the
<strong>ebnm</strong> package. After checking our new function using the
convenient checker <code><a href="../reference/ebnm_check_fn.html">ebnm_check_fn()</a></code>, we demonstrate that, as
expected, our new function performs better than the family of normal
priors when the “true means” <span class="math inline">\(\theta_i\)</span> are simulated from a scaled
<em>t</em> distribution.</p>
<p>Apart from using the common <strong>ebnm</strong> interface, we do
not have specific requirements for <strong>ebnm</strong>-style solvers
to be incorporated into the <strong>ebnm</strong> package. In general,
however, we prefer that code styling adheres to the <a href="https://style.tidyverse.org/" class="external-link">Tidyverse style guide</a>. Further,
we expect functions to be well-tested. At minimum, functions should pass
the tests in <code><a href="../reference/ebnm_check_fn.html">ebnm_check_fn()</a></code>. Additional unit tests are
strongly encouraged; <strong>ebnm</strong> runs unit tests on all
currently implemented prior families using the <strong>testthat</strong>
<a href="https://testthat.r-lib.org/" class="external-link">package</a>.</p>
</div>
<div class="section level2">
<h2 id="the-prior-family-class">The prior family class<a class="anchor" aria-label="anchor" href="#the-prior-family-class"></a>
</h2>
<p>The first step in implementing a solution to the EBNM problem with
scaled <em>t</em> prior is to define a data structure for the priors in
our prior family. In some cases, an existing data structure can be used.
For example, <code><a href="../reference/ebnm_normal.html">ebnm_normal()</a></code>,
<code><a href="../reference/ebnm_point_normal.html">ebnm_point_normal()</a></code>,
<code><a href="../reference/ebnm_normal_scale_mixture.html">ebnm_normal_scale_mixture()</a></code>, and
<code><a href="../reference/ebnm_point_mass.html">ebnm_point_mass()</a></code> all use the <code>"normalmix"</code>
class, which is borrowed from the <strong>ashr</strong> package. Here,
we will define a new class.</p>
<p><strong>ebnm</strong> uses these data structures in two ways: to give
information about the fitted prior <span class="math inline">\(\hat{g}\)</span> (via the <code>fitted_g</code>
field in the returned <code>"ebnm"</code> object); and to initialize
solutions (via the <code>g_init</code> argument). If one would like to
be able to arbitrarily initialize the solver, then the data structure
should include all information required to do so.</p>
<!-- Note, however, that **ebnm** places no restrictions on data
structure since any initialization using `g_init` must be implemented
within the custom function itself. In particular, we could choose to
simply ignore `g_init` and return `fitted_g = NULL` (though this is
not recommended, since it gives no information about the fitted prior
$\hat{g} \in \mathcal{G}$). -->
<p>For the scaled <em>t</em> prior, we define a new class,
<code>"tdist"</code>, that includes the scale and degrees of
freedom:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tdist</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">scale</span>, <span class="va">df</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">scale</span>, <span class="va">df</span><span class="op">)</span>, class <span class="op">=</span> <span class="st">"tdist"</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-optimization-function">The optimization function<a class="anchor" aria-label="anchor" href="#the-optimization-function"></a>
</h2>
<p>Next, we implement a function for estimating the two parameters
specifying the prior. This estimation is typically done by maximizing
the likelihood. There are many possible ways to perform this
maximization; for an overview of the many R packages available for
solving optimization problems using various algorithms and implementing
various constraints, see the <a href="https://cran.r-project.org/web/views/Optimization.html" class="external-link">CRAN task
view on optimization</a>. Solvers in the <strong>ebnm</strong> package
include an <code>optmethod</code> argument; when estimating parametric
priors (e.g., normal or point-Laplace), this argument allows the user to
choose among three general-purpose optimization methods: the Newton-type
algorithm implemented in the base R <code><a href="https://rdrr.io/r/stats/nlm.html" class="external-link">nlm()</a></code> function; the
L-BFGS-B algorithm implemented in the base R <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code>
function; and the trust region algorithm implemented in the
<strong>trust</strong> package. Further, the user can choose whether to
use analytic expressions to evaluate gradients and/or Hessians or
whether to estimate them using numerical methods. In general, we found
that it was often fastest to evaluate gradients analytically but to
allow Hessians to be computed numerically. We thus recommend including
the gradient for the log likelihood when it is straightforward to do
so.</p>
<p>Here, we will use the L-BFGS-B algorithm to maximize the log
likelihood since: 1. it doesn’t require installing any new packages; and
2. unlike <code><a href="https://rdrr.io/r/stats/nlm.html" class="external-link">nlm()</a></code>, it allows us to constrain parameters
(recall that <span class="math inline">\(\nu\)</span> and <span class="math inline">\(\sigma\)</span> should always be greater than
zero). To avoid numerical issues, we set sensible lower and upper bounds
for both parameters (namely, <span class="math inline">\(\min_i s_i / 10
\le \sigma \le \max_i x_i\)</span> and <span class="math inline">\(1 \le
\nu \le 1000\)</span>). Our optimization function takes initial
parameter estimates as input and returns optimal values for the
parameters of interest:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt_t</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma_init</span>, <span class="va">nu_init</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span></span>
<span>    par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sigma_init</span>, <span class="va">nu_init</span><span class="op">)</span>, </span>
<span>    fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span><span class="op">)</span> <span class="op">-</span><span class="fu">llik_t</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span><span class="op">/</span><span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">1e3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Notice that this function calls another function,
<code>llik_t()</code>, which is not yet implemented: this function will
compute the log likelihood at the current parameter estimates
<code>par[1]</code> and <code>par[2]</code>. Since <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code>
performs minimization by default, we take the negative of the log
likelihood.</p>
<p>The log likelihood involves an integral or <em>convolution</em> over
the unknown means:</p>
<p><span class="math display">\[\begin{equation}
\log p(\mathbf{x} \mid g, \, \mathbf{s}) =
\sum_{i=1}^n \textstyle \log
\int p(x_i \mid \theta_i, s_i) \, g(\theta_i) \, d\theta_i
\end{equation}\]</span></p>
<p>Inside the integral, we have the product of a normal distribution and
the prior, which in our case is a <em>t</em> distribution. We compute
this integral numerically using the built-in <code><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate()</a></code>
function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">llik_t</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma</span>, <span class="va">nu</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">llik_one_obs</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/stats/integrate.html" class="external-link">integrate</a></span><span class="op">(</span></span>
<span>      f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x</span> <span class="op">-</span> <span class="va">theta</span>, sd <span class="op">=</span> <span class="va">s</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">theta</span> <span class="op">/</span> <span class="va">sigma</span>, df <span class="op">=</span> <span class="va">nu</span><span class="op">)</span> <span class="op">/</span> <span class="va">sigma</span></span>
<span>      <span class="op">}</span>, </span>
<span>      lower <span class="op">=</span> <span class="op">-</span><span class="cn">Inf</span>, </span>
<span>      upper <span class="op">=</span> <span class="cn">Inf</span></span>
<span>    <span class="op">)</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">vllik</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html" class="external-link">Vectorize</a></span><span class="op">(</span><span class="va">llik_one_obs</span><span class="op">)</span> </span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu">vllik</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Notice that we have not included the gradient of the log likelihood
in our optimization function. Indeed, the gradient is difficult to
compute in this case, so we allow <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code> to estimate it
numerically. If, however, an efficient expression for computing the
gradient were available (e.g., by explicitly calculating the gradient or
using a package that performs automatic differentiation), we could
implement it as follows (replacing the numerical estimation of the
gradient using <strong>numDeriv</strong> with this more efficient
function):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">opt_t_grad</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma_init</span>, <span class="va">nu_init</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim</a></span><span class="op">(</span></span>
<span>    par <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sigma_init</span>, <span class="va">nu_init</span><span class="op">)</span>, </span>
<span>    fn <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span><span class="op">)</span> <span class="op">-</span><span class="fu">llik_t</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    gr <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">par</span><span class="op">)</span> <span class="op">-</span><span class="fu">grad_t</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"L-BFGS-B"</span>,</span>
<span>    lower <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="op">/</span> <span class="fl">10</span>, <span class="fl">1</span><span class="op">)</span>,</span>
<span>    upper <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="fl">1e3</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">grad_t</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma</span>, <span class="va">nu</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">numDeriv</span><span class="fu">::</span><span class="fu">grad</span><span class="op">(</span><span class="kw">function</span><span class="op">(</span><span class="va">par</span><span class="op">)</span> <span class="fu">llik_t</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">sigma</span>, <span class="va">nu</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-posterior-summary-function">The posterior summary function<a class="anchor" aria-label="anchor" href="#the-posterior-summary-function"></a>
</h2>
<p>The other key computation required to fit the EBNM model is the
computation of various statistics (means, variances, etc.) from the
posterior distribution of the “true means” given the prior we estimated.
From Bayes’ rule, the posterior distribution for the <em>i</em>th
unknown mean is</p>
<p><span class="math display">\[\begin{equation}
p(\theta_i \mid x_i, s_i, g) \propto
g(\theta_i) \, p(x_i \mid \theta_i, s_i),
\end{equation}\]</span></p>
<p>In this example, we summarize the posterior by the mean, standard
deviation and second moment:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">post_summary_t</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma</span>, <span class="va">nu</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">samp</span> <span class="op">&lt;-</span> <span class="fu">post_sampler_t</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma</span>, <span class="va">nu</span>, nsamp <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colMeans</a></span><span class="op">(</span><span class="va">samp</span><span class="op">)</span>,</span>
<span>    sd <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">samp</span>, <span class="fl">2</span>, <span class="va">sd</span><span class="op">)</span>,</span>
<span>    second_moment <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">samp</span>, <span class="fl">2</span>, <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The function requires a function <code>post_sampler_t</code> to draw
<em>random samples</em> from the posterior distribution. While drawing
independent samples is difficult, we can easily design an MCMC scheme to
approximately draw samples from the posterior. We implement this using
the <strong>mcmc</strong> package:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("mcmc")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stat.umn.edu/geyer/mcmc/" class="external-link">mcmc</a></span><span class="op">)</span></span>
<span><span class="va">post_sampler_t</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma</span>, <span class="va">nu</span>, <span class="va">nsamp</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">sample_one_theta</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x_i</span>, <span class="va">s_i</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">lpostdens</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">theta</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">dt</a></span><span class="op">(</span><span class="va">theta</span><span class="op">/</span><span class="va">sigma</span>, df <span class="op">=</span> <span class="va">nu</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">sigma</span><span class="op">)</span> <span class="op">+</span> </span>
<span>        <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">dnorm</a></span><span class="op">(</span><span class="va">x_i</span> <span class="op">-</span> <span class="va">theta</span>, sd <span class="op">=</span> <span class="va">s_i</span>, log <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/pkg/mcmc/man/metrop.html" class="external-link">metrop</a></span><span class="op">(</span><span class="va">lpostdens</span>, initial <span class="op">=</span> <span class="va">x_i</span>, nbatch <span class="op">=</span> <span class="va">nsamp</span><span class="op">)</span><span class="op">$</span><span class="va">batch</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">vsampler</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Vectorize.html" class="external-link">Vectorize</a></span><span class="op">(</span><span class="va">sample_one_theta</span><span class="op">)</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu">vsampler</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Note this is most likely not the most efficient way to compute
posterior summaries, but we tried to keep our implementation simple for
purposes of illustration.</p>
<!-- Given an optimal $\hat{g} \in \mathcal{G}$, we can obtain point
estimates for the "true means" $\theta_i$ using posterior means
$\mathbb{E}(\theta_i \mid x_i, s_i, \hat{g})$. In general, we might
like a number of summaries about the posterior. -->
<!-- including, for example, posterior standard deviations, second moments,
and local false sign rates [@Stephens_NewDeal]. If the EBNM solver is
intended for use in the **flashier** package, then posterior means and
second moments *must* be computed. -->
</div>
<div class="section level2">
<h2 id="putting-it-all-together">Putting it all together<a class="anchor" aria-label="anchor" href="#putting-it-all-together"></a>
</h2>
<p>We have now implemented the key computations for our new EBNM solver.
We will call this new solver <code>ebnm_t()</code> to be consistent with
other <strong>ebnm</strong> functions (<code><a href="../reference/ebnm_normal.html">ebnm_normal()</a></code>,
etc.).</p>
<p>The inputs should be the same as the other <strong>ebnm</strong>
functions. We will also use the same defaults. We can ignore parameters
that are not relevant (here, <code>optmethod</code> and
<code>control</code>).</p>
<!-- The `optmethod` parameter can typically be ignored unless we
want to make multiple optimization methods available for a single
prior family (e.g., both `nlm()` and `optim()`). We will also ignore
the `control` parameter, although it could be used here, for example,
to alter the default settings of `lower` and `upper` in the call to
`optim`. -->
<p>For simplicity, we will ignore the <code>output</code> parameter and
just return everything (the data, the posterior summaries, the fitted
prior, the log likelihood, and the posterior sampler). See
<code><a href="../reference/ebnm.html">help(ebnm)</a></code> for further details about the expected structure
of the returned <code>"ebnm"</code> object.</p>
<p>Here’s the new function:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ebnm_t</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, </span>
<span>                   <span class="va">s</span> <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                   <span class="va">mode</span> <span class="op">=</span> <span class="fl">0</span>, </span>
<span>                   <span class="va">scale</span> <span class="op">=</span> <span class="st">"estimate"</span>, </span>
<span>                   <span class="va">g_init</span> <span class="op">=</span> <span class="cn">NULL</span>, </span>
<span>                   <span class="va">fix_g</span> <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                   <span class="va">output</span> <span class="op">=</span> <span class="fu"><a href="../reference/ebnm.html">ebnm_output_default</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   <span class="va">optmethod</span> <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>                   <span class="va">control</span> <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span> <span class="op">{</span></span>
<span>                   </span>
<span>  <span class="co"># Some very basic argument checks.</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">mode</span> <span class="op">!=</span> <span class="fl">0</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"The mode of the t-prior must be fixed at zero."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">scale</span> <span class="op">!=</span> <span class="st">"estimate"</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"The scale of the t-prior must be estimated rather than fixed "</span>,</span>
<span>         <span class="st">"at a particular value."</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># If g_init is provided, extract the parameters. Otherwise, provide</span></span>
<span>  <span class="co"># reasonable initial estimates.</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">g_init</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sigma_init</span> <span class="op">&lt;-</span> <span class="va">g_init</span><span class="op">$</span><span class="va">scale</span></span>
<span>    <span class="va">nu_init</span>    <span class="op">&lt;-</span> <span class="va">g_init</span><span class="op">$</span><span class="va">df</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">sigma_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">x</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">nu_init</span>    <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># If g is fixed, use g_init. Otherwise optimize g.</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">fix_g</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">sigma</span> <span class="op">&lt;-</span> <span class="va">sigma_init</span></span>
<span>    <span class="va">nu</span>    <span class="op">&lt;-</span> <span class="va">nu_init</span></span>
<span>    <span class="va">llik</span>  <span class="op">&lt;-</span> <span class="fu">llik_t</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma</span>, <span class="va">nu</span><span class="op">)</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    <span class="va">opt_res</span> <span class="op">&lt;-</span> <span class="fu">opt_t</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma_init</span>, <span class="va">nu_init</span><span class="op">)</span></span>
<span>    <span class="va">sigma</span>   <span class="op">&lt;-</span> <span class="va">opt_res</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>    <span class="va">nu</span>      <span class="op">&lt;-</span> <span class="va">opt_res</span><span class="op">$</span><span class="va">par</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>    <span class="va">llik</span>    <span class="op">&lt;-</span> <span class="op">-</span><span class="va">opt_res</span><span class="op">$</span><span class="va">value</span></span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># Prepare the final output.</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, s <span class="op">=</span> <span class="va">s</span><span class="op">)</span>,</span>
<span>    posterior <span class="op">=</span> <span class="fu">post_summary_t</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma</span>, <span class="va">nu</span><span class="op">)</span>,</span>
<span>    fitted_g <span class="op">=</span> <span class="fu">tdist</span><span class="op">(</span>scale <span class="op">=</span> <span class="va">sigma</span>, df <span class="op">=</span> <span class="va">nu</span><span class="op">)</span>,</span>
<span>    log_likelihood <span class="op">=</span> <span class="va">llik</span>,</span>
<span>    post_sampler <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">nsamp</span><span class="op">)</span> <span class="fu">post_sampler_t</span><span class="op">(</span><span class="va">x</span>, <span class="va">s</span>, <span class="va">sigma</span>, <span class="va">nu</span>, <span class="va">nsamp</span><span class="op">)</span></span>
<span>  <span class="op">)</span>, class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"list"</span>, <span class="st">"ebnm"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="verifying-the-ebnm-function">Verifying the EBNM function<a class="anchor" aria-label="anchor" href="#verifying-the-ebnm-function"></a>
</h2>
<p><strong>ebnm</strong> provides a function,
<code><a href="../reference/ebnm_check_fn.html">ebnm_check_fn()</a></code>, that runs basic tests to verify that the
EBNM function works as expected. Let’s run the checks using a small,
simulated data set:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/stephenslab/ebnm" class="external-link">ebnm</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">100</span>, sd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">100</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/ebnm_check_fn.html">ebnm_check_fn</a></span><span class="op">(</span><span class="va">ebnm_t</span>, <span class="va">x</span>, <span class="va">s</span><span class="op">)</span></span>
<span><span class="co"># Function passed all checks.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="the-new-ebnm-function-in-action">The new EBNM function in action<a class="anchor" aria-label="anchor" href="#the-new-ebnm-function-in-action"></a>
</h2>
<p>Let’s illustrate the use of our new EBNM function on a data set in
which the (unobserved) means are simulated from a <em>t</em>
distribution with a scale of 2 and 5 degrees of freedom:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/TDist.html" class="external-link">rt</a></span><span class="op">(</span><span class="fl">100</span>, df <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">theta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span></span></code></pre></div>
<p>We will compare the use of the <em>t</em> prior with a normal prior,
which is implemented by <code><a href="../reference/ebnm_normal.html">ebnm_normal()</a></code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">normal_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/ebnm_normal.html">ebnm_normal</a></span><span class="op">(</span><span class="va">x</span>, s <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">t_res</span> <span class="op">&lt;-</span> <span class="fu">ebnm_t</span><span class="op">(</span><span class="va">x</span>, s <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<!-- Next we fit EBNM models using: 1. the family of normal priors, as
implemented by `ebnm_normal()`; and 2. the family of $t$ priors that
we just implemented. Due to our reliance on MCMC sampling to calculate
posterior means, fitting the second model is much slower than the
first (it took us about 15 seconds on a new MacBook Pro). -->
<p>You may have noticed that the call to <code>ebnm_t()</code> took
longer than the call to <code><a href="../reference/ebnm_normal.html">ebnm_normal()</a></code>. That is expected
because the computations with the <em>t</em> distribution are more
complex, and we did not put a lot of effort into making the computations
efficient.</p>
<p>Let’s compare the two results:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">normal_res</span>, <span class="va">t_res</span><span class="op">)</span></span></code></pre></div>
<p><img src="extending_ebnm_files/figure-html/plot-t-vs-normal-1.png" width="540" style="display: block; margin: auto;"></p>
<p>Most strikingly, <code>ebnm_t()</code> shrinks the large values less
aggressively than <code><a href="../reference/ebnm_normal.html">ebnm_normal()</a></code>. The fit with the <span class="math inline">\(t\)</span> prior also resulted in slightly more
accurate results overall:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rmse_normal</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">normal_res</span><span class="op">)</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">rmse_t</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">t_res</span><span class="op">)</span> <span class="op">-</span> <span class="va">theta</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>rmse_normal <span class="op">=</span> <span class="va">rmse_normal</span>, rmse_t <span class="op">=</span> <span class="va">rmse_t</span><span class="op">)</span></span>
<span><span class="co"># rmse_normal      rmse_t </span></span>
<span><span class="co">#   0.9498794   0.9397445</span></span></code></pre></div>
<!-- This improvement is as expected, since the true prior $g$ used to
simulate the data belongs to the family of $t$ distributions but not
the family of normal distributions.-->
<p>Finally, the estimated prior is not far from the parameters used to
simulate the data (<span class="math inline">\(\sigma = 2\)</span>,
<span class="math inline">\(\nu = 5\)</span>):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_res</span><span class="op">$</span><span class="va">fitted_g</span></span>
<span><span class="co"># $scale</span></span>
<span><span class="co"># [1] 1.682766</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># $df</span></span>
<span><span class="co"># [1] 3.813005</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># attr(,"class")</span></span>
<span><span class="co"># [1] "tdist"</span></span>
<span><span class="co"># attr(,"row.names")</span></span>
<span><span class="co"># [1] 1</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<p>The following R version and packages were used to generate this
vignette:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/sessionInfo.html" class="external-link">sessionInfo</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># R version 4.3.3 (2024-02-29)</span></span>
<span><span class="co"># Platform: aarch64-apple-darwin20 (64-bit)</span></span>
<span><span class="co"># Running under: macOS Sonoma 14.5</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># Matrix products: default</span></span>
<span><span class="co"># BLAS:   /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRblas.0.dylib </span></span>
<span><span class="co"># LAPACK: /Library/Frameworks/R.framework/Versions/4.3-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.11.0</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># locale:</span></span>
<span><span class="co"># [1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># time zone: America/Chicago</span></span>
<span><span class="co"># tzcode source: internal</span></span>
<span><span class="co"># </span></span>
<span><span class="co"># attached base packages:</span></span>
<span><span class="co"># [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># other attached packages:</span></span>
<span><span class="co"># [1] ebnm_1.1-27 mcmc_0.9-8 </span></span>
<span><span class="co"># </span></span>
<span><span class="co"># loaded via a namespace (and not attached):</span></span>
<span><span class="co">#  [1] sass_0.4.8         utf8_1.2.4         generics_0.1.3     ashr_2.2-66       </span></span>
<span><span class="co">#  [5] lattice_0.22-5     digest_0.6.34      magrittr_2.0.3     RColorBrewer_1.1-3</span></span>
<span><span class="co">#  [9] evaluate_0.23      grid_4.3.3         fastmap_1.1.1      jsonlite_1.8.8    </span></span>
<span><span class="co"># [13] Matrix_1.6-5       mixsqp_0.3-54      purrr_1.0.2        fansi_1.0.6       </span></span>
<span><span class="co"># [17] scales_1.3.0       truncnorm_1.0-9    invgamma_1.1       textshaping_0.3.7 </span></span>
<span><span class="co"># [21] jquerylib_0.1.4    cli_3.6.2          rlang_1.1.3        deconvolveR_1.2-1 </span></span>
<span><span class="co"># [25] munsell_0.5.0      splines_4.3.3      withr_3.0.0        cachem_1.0.8      </span></span>
<span><span class="co"># [29] yaml_2.3.8         tools_4.3.3        SQUAREM_2021.1     memoise_2.0.1     </span></span>
<span><span class="co"># [33] dplyr_1.1.4        colorspace_2.1-0   ggplot2_3.5.0      vctrs_0.6.5       </span></span>
<span><span class="co"># [37] R6_2.5.1           lifecycle_1.0.4    fs_1.6.3           trust_0.1-8       </span></span>
<span><span class="co"># [41] ragg_1.2.7         irlba_2.3.5.1      pkgconfig_2.0.3    desc_1.4.3        </span></span>
<span><span class="co"># [45] pkgdown_2.0.7      bslib_0.6.1        pillar_1.9.0       gtable_0.3.4      </span></span>
<span><span class="co"># [49] glue_1.7.0         Rcpp_1.0.12        systemfonts_1.0.6  highr_0.10        </span></span>
<span><span class="co"># [53] xfun_0.42          tibble_3.2.1       tidyselect_1.2.0   knitr_1.45        </span></span>
<span><span class="co"># [57] farver_2.1.1       htmltools_0.5.7    labeling_0.4.3     rmarkdown_2.26    </span></span>
<span><span class="co"># [61] compiler_4.3.3     horseshoe_0.2.0</span></span></code></pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jason Willwerscheid, Matthew Stephens, Peter Carbonetto.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
